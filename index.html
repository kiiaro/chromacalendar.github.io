<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calendário ChromaSolar Minimalista</title>
<link href="https://fonts.googleapis.com/css2?family=Alexandria:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
<style>
  :root {
    --primary-color: #fe6816;
    --secondary-color: #aa0000;
    --background-color: #ffffff;
    --text-color: #333333;
    --event-bg: #fe6816;
    --event-bg-dark: #aa0000;
    --font-family: 'Roboto', sans-serif;
    --header-font: 'Alexandria', sans-serif;
  }
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    padding: 20px;
    font-family: var(--font-family);
    background: var(--background-color);
    min-height: 100vh;
    color: var(--text-color);
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  header {
    width: 100%;
    height: 80px;
    background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    font-family: var(--header-font);
  }
  .main-content {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    width: 100%;
    max-width: 1000px;
  }
  .calendar {
    position: relative;
    width: 100%;
    max-width: 1000px;
    background: linear-gradient(180deg, rgba(254,104,22,0.1) 0%, var(--background-color) 100%);
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    padding: 30px;
    transition: transform 0.3s ease;
    z-index: 10;
  }
  .calendar:hover {
    transform: scale(1.01);
    box-shadow: 0 6px 30px rgba(254,104,22,0.3);
  }
  .calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  .calendar-header button {
    background: var(--primary-color);
    border: none;
    color: #ffffff;
    padding: 10px 20px;
    border-radius: 25px;
    font-weight: 700;
    cursor: pointer;
    font-size: 1.2rem;
    transition: background-color 0.3s ease;
  }
  .calendar-header button:hover {
    background: var(--secondary-color);
  }
  .month-year {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary-color);
    letter-spacing: 1px;
  }
  .days-of-week,
  .days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    transition: opacity 0.3s ease;
  }
  .days-of-week div {
    text-align: center;
    font-weight: 700;
    padding: 10px 0;
    color: var(--primary-color);
    text-transform: uppercase;
    font-size: 0.9rem;
  }
  .day {
    background: transparent;
    border: 1px solid transparent;
    border-radius: 10px;
    padding: 10px;
    margin: 4px;
    min-height: 100px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
  }
  .day:hover {
    border-color: var(--secondary-color);
    background: rgba(254,104,22,0.05);
    transform: scale(1.05);
  }
  .day-number {
    font-weight: 700;
    margin-bottom: 5px;
    color: var(--primary-color);
    font-size: 1.2rem;
  }
  .events {
    max-height: 70px;
    overflow-y: auto;
    flex-grow: 1;
  }
  .event {
    background-color: var(--event-bg);
    color: #ffffff;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.75rem;
    padding: 4px 10px;
    margin-bottom: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: background-color 0.3s ease;
    cursor: pointer;
  }
  .event:hover {
    background-color: var(--event-bg-dark);
  }
  .event:hover::after {
    content: attr(data-full);
    position: absolute;
    bottom: 120%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--secondary-color);
    color: #ffffff;
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 0.85rem;
    white-space: normal;
    max-width: 200px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    z-index: 30;
    pointer-events: none;
  }
  ::-webkit-scrollbar {
    width: 4px;
  }
  ::-webkit-scrollbar-thumb {
    background: var(--primary-color);
    border-radius: 20px;
  }
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  .event-sidebar {
    width: 300px;
    margin-left: 20px;
    padding: 20px;
    background: var(--background-color);
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  }
  .event-sidebar h3 {
    font-size: 1.5rem;
    color: var(--primary-color);
    margin-bottom: 15px;
  }
  .event-card {
    background: var(--event-bg);
    color: #ffffff;
    padding: 10px;
    border-radius: 10px;
    margin-bottom: 10px;
    font-size: 0.9rem;
  }
  @media (max-width: 720px) {
    .calendar-header {
      flex-direction: column;
      gap: 15px;
    }
    .days-of-week div,
    .day {
      font-size: 0.75rem;
      padding: 8px;
      min-height: 80px;
      margin: 3px;
    }
    .day-number {
      font-size: 1rem;
    }
    .calendar {
      padding: 20px;
      max-width: 100vw;
      border-radius: 12px;
    }
    .event-sidebar {
      width: 100%;
      margin-left: 0;
      margin-top: 20px;
    }
    .main-content {
      flex-direction: column;
      align-items: center;
    }
  }
  #modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(8px);
    justify-content: center;
    align-items: center;
    animation: modalFadeIn 0.3s ease forwards;
  }
  #modal.active {
    display: flex;
  }
  @keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  #modal-content {
    background: #ffffff;
    border-radius: 20px;
    padding: 30px;
    width: 360px;
    box-shadow: 0 10px 40px rgba(254,104,22,0.4);
    font-family: var(--font-family);
    color: var(--text-color);
  }
  #modal-content h2 {
    margin-top: 0;
    color: var(--primary-color);
    font-weight: 700;
    font-size: 1.8rem;
    margin-bottom: 20px;
    text-align: center;
  }
  #modal-content p {
    margin: 10px 0;
    font-size: 1rem;
  }
  #modal-content label {
    display: block;
    margin: 10px 0 5px;
    font-weight: 600;
    color: var(--primary-color);
  }
  #modal-content input[type="text"],
  #modal-content input[type="date"],
  #modal-content input[type="time"] {
    width: 100%;
    padding: 10px;
    font-size: 1rem;
    border-radius: 12px;
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    color: var(--text-color);
    transition: border-color 0.3s ease;
  }
  #modal-content input::placeholder {
    color: #999;
    font-style: italic;
  }
  #modal-content input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 10px rgba(254,104,22,0.3);
  }
  #modal-content .actions {
    margin-top: 25px;
    display: flex;
    justify-content: flex-end;
    gap: 15px;
  }
  #modal-content button {
    cursor: pointer;
    padding: 12px 30px;
    border-radius: 25px;
    font-weight: 700;
    border: none;
    transition: background-color 0.3s;
    font-size: 0.95rem;
  }
  #btn-cancel, #btn-close {
    background: transparent;
    color: var(--primary-color);
    border: 2px solid var(--primary-color);
  }
  #btn-cancel:hover, #btn-close:hover {
    background: var(--primary-color);
    color: #ffffff;
  }
  #btn-save {
    background: var(--primary-color);
    color: #ffffff;
  }
  #btn-save:hover {
    background: var(--secondary-color);
  }
  #btn-delete {
    background: #ff6b6b;
    color: #ffffff;
  }
  #btn-delete:hover {
    background: #d9534f;
  }
  #error-msg {
    color: #ff6b6b;
    font-weight: 600;
    margin-top: 10px;
    font-size: 0.9rem;
    min-height: 20px;
    text-align: center;
  }
</style>
</head>
<body>
  <header></header>

  <div class="main-content">
    <div class="calendar" tabindex="0" aria-label="Calendário interativo">
      <div class="calendar-header">
        <button id="prev-month" aria-label="Mês anterior" title="Mês anterior">◄</button>
        <div class="month-year" aria-live="polite" aria-atomic="true"></div>
        <button id="next-month" aria-label="Próximo mês" title="Próximo mês">►</button>
      </div>
      <div class="days-of-week" role="row">
        <div role="columnheader">Dom</div>
        <div role="columnheader">Seg</div>
        <div role="columnheader">Ter</div>
        <div role="columnheader">Qua</div>
        <div role="columnheader">Qui</div>
        <div role="columnheader">Sex</div>
        <div role="columnheader">Sáb</div>
      </div>
      <div class="days" role="grid" aria-label="Dias do mês"></div>
    </div>

    <div class="event-sidebar">
      <h3>Eventos do Dia</h3>
      <div id="event-list"></div>
    </div>
  </div>

  <div id="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1">
    <div id="modal-content">
      <h2 id="modal-title">Criar Evento</h2>
      <div id="modal-body">
        <form id="event-form" novalidate>
          <label for="event-subject">Assunto (opcional)</label>
          <input type="text" id="event-subject" name="event-subject" autocomplete="off" placeholder="Ex: Reunião, Consulta" maxlength="50" />

          <label for="event-name">Nome do Evento</label>
          <input type="text" id="event-name" name="event-name" required autocomplete="off" placeholder="Insira o nome do evento" maxlength="60" />

          <label for="event-date">Data</label>
          <input type="date" id="event-date" name="event-date" required />

          <label for="start-time">Hora Início</label>
          <input type="time" id="start-time" name="start-time" required />

          <label for="end-time">Hora Término</label>
          <input type="time" id="end-time" name="end-time" required />

          <div id="error-msg" aria-live="assertive"></div>

          <div class="actions">
            <button type="button" id="btn-cancel">Cancelar</button>
            <button type="submit" id="btn-save">Salvar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

<script>
  const monthYearLabel = document.querySelector('.month-year');
  const daysContainer = document.querySelector('.days');
  const prevBtn = document.getElementById('prev-month');
  const nextBtn = document.getElementById('next-month');
  const modal = document.getElementById('modal');
  const modalTitle = document.getElementById('modal-title');
  const modalBody = document.getElementById('modal-body');
  const form = document.getElementById('event-form');
  const btnCancel = document.getElementById('btn-cancel');
  const errorMsg = document.getElementById('error-msg');
  const eventList = document.getElementById('event-list');

  let current = new Date();
  let events = JSON.parse(localStorage.getItem('chroma-events')) || {};
  let selectedDateKey = null;
  let selectedEventIndex = null;

  function pad(n) {
    return n < 10 ? '0' + n : n;
  }
  function getDateKey(year, month, day) {
    return year + '-' + pad(month) + '-' + pad(day);
  }

  function renderCalendar() {
    daysContainer.style.opacity = '0';
    setTimeout(() => {
      daysContainer.innerHTML = '';
      const year = current.getFullYear();
      const month = current.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay();
      const daysInMonth = lastDay.getDate();

      monthYearLabel.textContent = current.toLocaleString('pt-BR', {
        month: 'long',
        year: 'numeric'
      });

      for (let i = 0; i < startDay; i++) {
        const blank = document.createElement('div');
        blank.className = 'day';
        daysContainer.appendChild(blank);
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const dateKey = getDateKey(year, month + 1, day);
        const dayEl = document.createElement('div');
        dayEl.className = 'day';
        dayEl.tabIndex = 0;

        const dayNumberDiv = document.createElement('div');
        dayNumberDiv.className = 'day-number';
        dayNumberDiv.textContent = day;
        dayEl.appendChild(dayNumberDiv);

        const eventsDiv = document.createElement('div');
        eventsDiv.className = 'events';
        dayEl.appendChild(eventsDiv);

        if (events[dateKey]) {
          events[dateKey].sort((a, b) => a.startTime.localeCompare(b.startTime));
          events[dateKey].forEach((event, index) => {
            const evt = document.createElement('div');
            evt.className = 'event';
            let tooltipText = `Assunto: ${event.subject || 'N/A'}\nNome: ${event.name}\nHorário: ${event.startTime} - ${event.endTime}`;
            evt.setAttribute('data-full', tooltipText);
            let displayText = event.subject && event.subject.trim().length > 0 ? (event.subject.trim().length > 12 ? event.subject.trim().substring(0, 12) + '…' : event.subject.trim()) + ': ' : '';
            displayText += event.name.length > 16 ? event.name.substring(0, 16) + '…' : event.name;
            evt.textContent = displayText;
            evt.addEventListener('click', () => openEventModal(dateKey, index));
            eventsDiv.appendChild(evt);
          });
        }

        dayEl.addEventListener('click', (e) => {
          if (!e.target.classList.contains('event')) {
            selectedDateKey = dateKey;
            openCreateEventModal(dateKey);
            renderEventSidebar(dateKey);
          }
        });

        dayEl.addEventListener('keypress', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            dayEl.click();
          }
        });

        daysContainer.appendChild(dayEl);
      }
      daysContainer.style.opacity = '1';
    }, 300);
  }

  function renderEventSidebar(dateKey) {
    eventList.innerHTML = '';
    if (events[dateKey]) {
      events[dateKey].forEach(event => {
        const card = document.createElement('div');
        card.className = 'event-card';
        card.textContent = `${event.startTime} - ${event.endTime}: ${event.name}${event.subject ? ` (${event.subject})` : ''}`;
        eventList.appendChild(card);
      });
    } else {
      eventList.innerHTML = '<p>Nenhum evento para este dia.</p>';
    }
  }

  function openCreateEventModal(dateKey) {
    modalTitle.textContent = 'Criar Evento';
    modalBody.innerHTML = `
      <form id="event-form" novalidate>
        <label for="event-subject">Assunto (opcional)</label>
        <input type="text" id="event-subject" name="event-subject" autocomplete="off" placeholder="Ex: Reunião, Consulta" maxlength="50" />

        <label for="event-name">Nome do Evento</label>
        <input type="text" id="event-name" name="event-name" required autocomplete="off" placeholder="Insira o nome do evento" maxlength="60" />

        <label for="event-date">Data</label>
        <input type="date" id="event-date" name="event-date" required value="${dateKey}" />

        <label for="start-time">Hora Início</label>
        <input type="time" id="start-time" name="start-time" required />

        <label for="end-time">Hora Término</label>
        <input type="time" id="end-time" name="end-time" required />

        <div id="error-msg" aria-live="assertive"></div>

        <div class="actions">
          <button type="button" id="btn-cancel">Cancelar</button>
          <button type="submit" id="btn-save">Salvar</button>
        </div>
      </form>
    `;
    modal.classList.add('active');
    const newForm = document.getElementById('event-form');
    const newBtnCancel = document.getElementById('btn-cancel');
    newBtnCancel.addEventListener('click', closeModal);
    newForm.addEventListener('submit', handleEventSubmit);
    document.getElementById('event-subject').focus();
  }

  function openEventModal(dateKey, eventIndex) {
    const event = events[dateKey][eventIndex];
    selectedDateKey = dateKey;
    selectedEventIndex = eventIndex;
    modalTitle.textContent = 'Detalhes do Evento';
    modalBody.innerHTML = `
      <p><strong>Assunto:</strong> ${event.subject || 'N/A'}</p>
      <p><strong>Nome:</strong> ${event.name}</p>
      <p><strong>Horário:</strong> ${event.startTime} - ${event.endTime}</p>
      <div class="actions">
        <button type="button" id="btn-delete">Apagar</button>
        <button type="button" id="btn-close">Fechar</button>
      </div>
    `;
    modal.classList.add('active');
    const btnDelete = document.getElementById('btn-delete');
    const btnClose = document.getElementById('btn-close');
    btnDelete.addEventListener('click', handleEventDelete);
    btnClose.addEventListener('click', closeModal);
  }

  function handleEventSubmit(e) {
    e.preventDefault();
    const errorMsg = document.getElementById('error-msg');
    errorMsg.textContent = '';

    const subject = e.target['event-subject'].value.trim();
    const name = e.target['event-name'].value.trim();
    const date = e.target['event-date'].value;
    const startTime = e.target['start-time'].value;
    const endTime = e.target['end-time'].value;

    if (!name || !date || !startTime || !endTime) {
      errorMsg.textContent = 'Por favor, preencha todos os campos obrigatórios.';
      return;
    }
    if (startTime > endTime) {
      errorMsg.textContent = 'A hora de início deve ser anterior ou igual à hora de término.';
      return;
    }

    if (!events[date]) events[date] = [];
    events[date].push({ subject, name, startTime, endTime });
    localStorage.setItem('chroma-events', JSON.stringify(events));

    closeModal();
    renderCalendar();
    renderEventSidebar(date);
  }

  function handleEventDelete() {
    events[selectedDateKey].splice(selectedEventIndex, 1);
    if (events[selectedDateKey].length === 0) {
      delete events[selectedDateKey];
    }
    localStorage.setItem('chroma-events', JSON.stringify(events));
    closeModal();
    renderCalendar();
    renderEventSidebar(selectedDateKey);
  }

  function closeModal() {
    modal.classList.remove('active');
    modalBody.innerHTML = '';
  }

  modal.addEventListener('click', e => {
    if (e.target === modal) closeModal();
  });

  prevBtn.addEventListener('click', () => {
    current.setMonth(current.getMonth() - 1);
    renderCalendar();
  });
  nextBtn.addEventListener('click', () => {
    current.setMonth(current.getMonth() + 1);
    renderCalendar();
  });

  renderCalendar();
  nextBtn.focus();
</script>
</body>
</html>